name: Release

on:
  push:
    tags:
      - "v*"

jobs:
  release:
    name: Create GitHub Release
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Extract changelog for this version
        id: changelog
        run: |
          VERSION=${GITHUB_REF#refs/tags/v}
          echo "version=${VERSION}" >> $GITHUB_OUTPUT
          
          # Extract section between this version and the next ---
          awk "/## \[${VERSION}\]/{found=1; next} /^---$/{if(found) exit} found{print}" \
            CHANGELOG.md > release_notes.md
          
          echo "ðŸ“‹ Release notes for v${VERSION}:"
          cat release_notes.md

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          body_path: release_notes.md
          generate_release_notes: true
          draft: false
          prerelease: ${{ contains(github.ref, 'alpha') || contains(github.ref, 'beta') }}
          
      - name: Release summary
        run: |
          echo "âœ… Release v${GITHUB_REF#refs/tags/v} created successfully"
          echo "ðŸ”— View at: https://github.com/${{ github.repository }}/releases/tag/${GITHUB_REF#refs/tags/}"
